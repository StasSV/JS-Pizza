<% include header.ejs %>
<div class="order">


    <div class="forms">

        <h2 class="contacts">1.Контактні дані</h2>

        <div class="col-sm-8">

            <div class="left">

                <div class="form-group name-group">
                    <div class="col-sm-6">
                        <label class="names">
                            Ім'я
                        </label>
                    </div>
                    <div class="col-sm-6">
                        <input type="Text" id="user_name" class="form-control" placeholder="Type your name here"
                               oninput="readName()">
                    </div>
                    <span class="help-block">Enter ONLY your name & surname</span>
                </div>

                <div class="form-group name-group">
                    <div class="col-sm-6">
                        <label class="names">
                            Телефон
                        </label>
                    </div>
                    <div class="col-sm-6">
                        <input type="Text" id="user_phone" class="form-control" placeholder="+380000000000"
                               oninput="readPhone()">
                    </div>


                    <span class="help-block">Enter your phone number </span>
                </div>

                <div class="form-group phone-group">
                    <div class="col-sm-6">
                        <label class="names">
                            Адреса
                        </label>
                    </div>
                    <div class="col-sm-6">
                        <input type="Text" id="user_adress" class="form-control" placeholder="КМЦ"
                               oninput="readAdress()"></div>
                    <span class="help-block">Enter your phone number </span>
                </div>


            </div>
        </div>

        <script> // THIS IS FOR CHECKING VALIDATION OF INPUT AREAS
            function readName() {

                var name = document.getElementById("user_name");
                var x = name.value;
                var regex = /^[0-9]+$/;
                if (x.charAt(x.length - 1).match(regex)) {
                    name.style.backgroundColor = "#ffc1c3";
                    name.style.color = "red";
                } else {
                    name.style.backgroundColor = "#b8ffb7";
                    name.style.color = "green ";
                }
                if (x.length == 0) {
                    name.style.backgroundColor = "#ffc1c3";
                    name.style.color = "red ";
                }
            }
            var maxcount = 13;
            function readPhone() {
                var phone = document.getElementById("user_phone");
                var x = phone.value;
                var regex = /^[0-9]+$/;
                if (!x.charAt(x.length - 1).match(regex)) {
                    phone.style.backgroundColor = "#ffc1c3";
                    phone.style.color = "red ";
                } else {
                    phone.style.backgroundColor = "#b8ffb7";
                    phone.style.color = "green";
                }
                if (x.length !== maxcount) {
                    phone.style.backgroundColor = "#ffc1c3";
                    phone.style.color = "red ";
                }
            }
            function readAdress() {
                var adress = document.getElementById("user_adress");
                var x = adress.value;
                if (x.length == 0) {
                    adress.style.backgroundColor = "#ffc1c3";
                    adress.style.color = "red ";
                } else {
                    adress.style.backgroundColor = "#b8ffb7";
                    adress.style.color = "green";
                }
            }
            function sendData() {
                var $name = document.getElementById("user_name").value;
                var $phone = document.getElementById("user_phone").value;
                var $adress = document.getElementById("user_adress").value;
//                document.getElementById("adressStatus").value = $adress;
//                var content = require('../../API');
//                content.createOrder($name, function (err, order_info, callback) {
//                });
//                content.createOrder($phone, function (err, order_info, callback) {
//                });
//                content.createOrder($adress, function (err, order_info, callback) {
//                });
                console.log("success");
            }
        </script>

        <div class="col-sm-4">
            <div class="right">
                <div class="infoOrder">
                    <div class="infoHead">
                        Інформація про замовлення
                    </div>
                    <div class="time">
                        <b>
                            Приблизний час доставки:
                        </b>
                        <span class="timeStatus">
                            3 хв
                        </span>
                    </div>

                    <div class="adress">
                        <b>
                            Адреса доставки:
                        </b>
                        <span class="adressStatus">
                            КМЦ
                        </span>
                    </div>


                </div>
            </div>
        </div>

        <button type="next" class="btn btn-warning" onclick="sendData()"><b>Далі ></b></button>


    </div>
    <div class="rightPanel ">
        <div class="rTop">
        <span class="order">
            Замовлення
        </span>

            <label class="label label-warning inCart">
                0
            </label>
            <br>
            <span class="clear">Очистити замовлення</span>
        </div>

        <div id="cart" class="rContainer">


        </div>

        <div class="rBottom">
            <div class="sumText">
                <b>Сума замовлення</b>
            </div>
            <div class="sum">
                <b>
                    <span class="summ">0</span> грн.</b>
            </div>
            <div class="rb">
                <div class="col-sm-12 col-md-12">
                    <button type="accept" class="btn btn-lg btn-warning">Замовити</button>
                </div>
            </div>
        </div>

    </div>
</div>

<script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD2biXp0mMOXjOqzgNKhREM-H4OG-2rc-g">
</script>
<script src="http://static.liqpay.com/libjs/checkout.js" async></script>

<!-- місце для віджету -->
<!--<div id="liqpay" style="width:800px;height:400px;background:yellow;-->
<!--margin-left:10%;margin-right:auto;margin-top: 35%">-->
<!--<p>-->
<!--liqpay form is here-->
<!--</p>-->
<!--<button id="bLiq" onclick="liqPayInit()"></button>-->
<!--</div>-->
<!-- піключаємо скрипт -->
<!--<script-->
<!--src="static.liqpay.com/libjs/checkout.js">-->
<!--</script>-->


<script>
    public_key = 'i8990856747';
    private_key = 'u5hKYg2IegXGX78oPvYs62RkbKt5CXRYZMYyOfK1';

    var LiqPay = require('liqpay');
    var liqpay = new LiqPay(public_key, private_key);
    var html = liqpay.cnb_form({
        'public_key': public_key,
        'action': 'pay',
        'amount': '1',
        'currency': 'USD',
        'description': 'description text',
        'order_id': 'order_id_1',
        'version': '3',
        'sandbox': '1'
    });
    data_test_value = "eyAidmVyc2lvbiIgOiAzLCAicHVibGljX2tleSIgOiAieW91cl9wdWJsaWNfa2V5IiwgImFjdGlv" +
        "biIgOiAicGF5IiwgImFtb3VudCIgOiAxLCAiY3VycmVuY3kiIDogIlVTRCIsICJkZXNjcmlwdGlv" +
        "biIgOiAiZGVzY3JpcHRpb24gdGV4dCIsICJvcmRlcl9pZCIgOiAib3JkZXJfaWRfMSIgfQ=="

    signature_test_value = "QvJD5u9Fg55PCx/Hdz6lzWtYwcI=";

    function base64(str) {
        return new Buffer(str).toString('base64');
    }
    ;

    function sha1(str) {
        var crypto = require('crypto-js');
        var sha1 = crypto.createHash('sha1');
        return sha1.update(str);
        //return sha1.digest('base64');
    }
    ;


    function prepare_data() {
        alert('prepare');
        var public_key = 'i8990856747';
        var private_key = 'u5hKYg2IegXGX78oPvYs62RkbKt5CXRYZMYyOfK1';
        var data_json = {
            'public_key': 'i8990856747',
            'action': 'pay',
            'amount': '1',
            'currency': 'USD',
            'description': 'description text',
            'order_id': 'order_id_1',
            'version': '3',
            'sandbox': '1'
        }
        var data = window.btoa(JSON.stringify(data_json));
        document.getElementById("card_form_data").value = data;
        //var signature =  window.btoa(sha1( private_key+data+private_key));
        var signature = window.btoa(sha1(private_key));

        alert(signature);
        document.getElementById("card_form_signature").value = signature;
    }
    ;

</script>
</head>

<body>
<form id="card_form" style="margin-top: 35%" method="POST" onsubmit="prepare_data()"
      action="https://www.liqpay.com/api/3/checkout"
      accept-charset="utf-8">
    <input type="hidden" id="card_form_data" name="data" value=card_form_data/>
    <input type="hidden" id="card_form_signature" name="signature" value=signature_test_value/>

    <span name="helper_color"
          style="text-align: center;color: rgb(132, 146, 166); margin: 0.5%"><span>Card number</span>
        <input el="Card" placeholder="●●●●&nbsp;●●●●&nbsp;●●●●&nbsp;●●●●" autocomplete="off"
               style="text-align: center; width: 289px; color: rgb(24, 28, 32);">
    </span>

    <span name="helper_color" style="text-align: center;color: rgb(132, 146, 166);margin: 0.5%">validity
        <input el="MMYY" placeholder="MM/YY" type="tel" class="input input__validity" role="input" maxlength="7"
               autocomplete="off" style="text-align: center; color: rgb(24, 28, 32);">
    </span>

    <span name="helper_color" style="text-align: center; color: rgb(132, 146, 166);margin: 0.5%">CVV
        <input el="CardCvv" pattern="[0-9]*" placeholder="●●●" type="password"
               onkeyup="this.value=this.value.replace(/[^0-9.]/ig,'')" maxlength="3" autocomplete="off"
               style="color: rgb(24, 28, 32);">

    </span>

    <div name="helper_color" style="text-align: center; color: rgb(132, 146, 166);">
        <input type="image"
               src="http://static.liqpay.com/buttons/p1ru.radius.png"/>
    </div>

</form>

<div id="liqpay_checkout">
</div>
<script>
    window.LiqPayCheckoutCallback = function () {
        // alert('LiqPayCheckout.init');

        LiqPayCheckout.init({
            data: "eyAidmVyc2lvbiIgOiAzLCAicHVibGljX2tleSIgOiAieW91cl9wdWJsaWNfa2V5IiwgImFjdGlv" +
            "biIgOiAicGF5IiwgImFtb3VudCIgOiAxLCAiY3VycmVuY3kiIDogIlVTRCIsICJkZXNjcmlwdGlv" +
            "biIgOiAiZGVzY3JpcHRpb24gdGV4dCIsICJvcmRlcl9pZCIgOiAib3JkZXJfaWRfMSIgfQ==",
            signature: "QvJD5u9Fg55PCx/Hdz6lzWtYwcI=",
            embedTo: "#liqpay_checkout",
            mode: "embed" // embed || popup
        }).on("liqpay.callback", function (data) {
            console.log(data.status);
            console.log(data);
        }).on("liqpay.ready", function (data) {
            // ready
        }).on("liqpay.close", function (data) {
            // close
        });
    };
</script>
<!--<script src="http://static.liqpay.com/libjs/checkout.js" async>-->
<!--</script>-->


<div id="mapjs" style="width:800px;height:400px;background:gray;
margin-left:10%;margin-right:auto; margin-bottom: 10%"><p>....OOPS SOMETHING WRONG IS GOING ON </BR> THE MAP MUST BE
        PLACED HERE </p>
</div>

<script>
    function initMap() {
        var markers = [];
        var pizzaPlace = {lat: 50.464379, lng: 30.519131};
        var kmz = {lat: 50.466121, lng: 30.523392};

        var map = new google.maps.Map(document.getElementById('mapjs'), {
            center: pizzaPlace,
            zoom: 16
        });

        var directionsDisplay = new google.maps.DirectionsRenderer({
            map: map
        });

        var request = {
            destination: kmz,
            origin: pizzaPlace,
            travelMode: 'DRIVING'
        };
       //     alert(directionsService.getDuration ().seconds + " seconds") ;


        // Pass the directions request to the directions service.
        var directionsService = new google.maps.DirectionsService();
        directionsService.route(request, function (response, status) {
            if (status == 'OK') {
                directionsDisplay.setDirections(response);
            }
        });
        // This event listener will call addMarker() when the map is clicked.
        map.addListener('click', function (event) {
            // alert('clickDone');
            addMarker(event.latLng);
            calcRoute();
        });
        function calcRoute() {
            var start = pizzaPlace;
            var end = event.latLng.value;
            var request = {
                origin:start,
                destination:end,
                travelMode: DRIVING
            };
            directionsService.route(request, function(response, status) {
                if (status == google.maps.DirectionsStatus.OK) {
                    directionsDisplay.setDirections(response);
                }
            });
        }


        var point = new google.maps.LatLng(50.464379, 30.519131);
        var marker = new google.maps.Marker({
            position: point,
            map: map,
            icon: "assets/images/map-icon.png"
        });
        var marker = new google.maps.Marker({
            position: kmz,
            map: map,
            icon: "assets/images/home-icon.png"
        });

        // Adds a marker to the map and push to the array.
        function addMarker(location) {
            // var point = new google.maps.LatLng(50.464379,30.519131);
            var marker = new google.maps.Marker({
                position: location,
                map: map,
                icon: "assets/images/home-icon.png"
            });
        }

        // google.maps.event.addDomListener(window, 'load', initMap);
    }
    google.maps.event.addDomListener(window, 'load', initMap);

</script>


<% include footer.ejs %>